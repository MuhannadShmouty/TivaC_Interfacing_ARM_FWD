/******************************************************************************************************
 *  FILE DESCRIPTION
 *  -------------------------------------------------------------------------------------------------*/
/*      
 *  \file  Systick.c
 *  \brief 
 * 
 *  \details
 *****************************************************************************************************/

/******************************************************************************************************
 *  INCLUDES
 *****************************************************************************************************/
#include "Systick.h"

/******************************************************************************************************
 *  LOCAL MACROS CONSTANT\FUNCTIONS
 *****************************************************************************************************/
#define FREQ		16000000
/******************************************************************************************************
 *  LOCAL DATA
 *****************************************************************************************************/

/******************************************************************************************************
 *  GLOBAL DATA
 *****************************************************************************************************/
cb_type Callback_ptr = NULL;
/******************************************************************************************************
 *  LOCAL FUNCTION PROTOTYPES
 *****************************************************************************************************/

/******************************************************************************************************
 *  LOCAL FUNCTIONS
 *****************************************************************************************************/

void SysTick_Handler(void)
{
	if (Callback_ptr != NULL)
	{
		Callback_ptr();
	}
}

/******************************************************************************************************
 *  GLOBAL FUNCTIONS
 *****************************************************************************************************/


void Systick_Init(uint32_t delay_ms)
{
	/* Configure the reload value in STRELOAD register */
	
	STRELOAD.B.RELOAD = (delay_ms * (FREQ/1000)) - 1;
	
	/* Clear the STCURRENT register */
	STCURRENT.B.CURRENT = 0;
	
	/* Choose clock source (PIOSC/4 or System clock) */
	STCTRL.B.CLK_SRC = 1;
	/* Enable the systick */
	STCTRL.B.EN = 1;
	/* Enable Systick interrupt */	
	STCTRL.B.INTEN = 1;
}

void Systick_cb(cb_type ptr)
{
	if (ptr != NULL)
	{
		Callback_ptr = ptr;
	}
}


/******************************************************************************************************
 *  END OF FILE:    Systick.c
 *****************************************************************************************************/